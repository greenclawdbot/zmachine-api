#!/usr/bin/env node
import * as fs from "fs";
import Log from "./log.js";
import Game from "./ebozz.js";
import { ScreenBase } from "./Screen.js";
const gameFile = process.argv[2];
const walkthroughFile = process.argv[3];
const walkthrough = fs.readFileSync(walkthroughFile, "utf8").split("\n");
let command = 0;
function getNextLine() {
    let line;
    do {
        if (command === walkthrough.length) {
            return;
        }
        line = walkthrough[command++].trim();
    } while (line === "" || line[0] === "#");
    return line;
}
class TestRunnerScreen extends ScreenBase {
    constructor(log) {
        super(log, "TestRunnerScreen");
    }
    getInputFromUser(game, input_state) {
        const input = getNextLine();
        if (!input) {
            process.exit(0);
        }
        process.stdout.write(input + "\n");
        game.continueAfterUserInput(input_state, input);
    }
    print(game, str) {
        process.stdout.write(str);
    }
}
class TestRunnerStorage {
    saveSnapshot(game) {
        fs.writeFileSync("snapshot.dat", game.snapshotToBuffer(), {
            encoding: "binary",
        });
    }
    loadSnapshot(_game) {
        const f = fs.readFileSync("snapshot.dat");
        const b = Buffer.from(f.buffer);
        return Game.readSnapshotFromBuffer(b);
    }
}
const log = new Log(false);
const game = new Game(fs.readFileSync(gameFile), log, new TestRunnerScreen(log), new TestRunnerStorage());
game.execute();
//# sourceMappingURL=test-runner.js.map