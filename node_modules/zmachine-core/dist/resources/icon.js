// font 3 character graphics definitions
// Here is a copy / pasted text of the spec section 16.1
const spec = String.raw `
32( ):  76543210   33(!):  76543210   34("):  76543210   35(#):  76543210
0                  0                  0                  0       #
1                  1                  1                  1      # 
2                  2  #               2    #             2     #  
3                  3 ##               3    ##            3    #   
4                  4#######           4#######           4   #    
5                  5 ##               5    ##            5  #     
6                  6  #               6    #             6 #      
7                  7                  7                  7#       
36($):  76543210   37(%):  76543210   38(&):  76543210   39('):  76543210
0#                 0                  0                  0        
1 #                1                  1                  1        
2  #               2                  2                  2        
3   #              3                  3                  3########
4    #             4                  4########          4        
5     #            5                  5                  5        
6      #           6                  6                  6        
7       #          7                  7                  7        
40(():  76543210   41()):  76543210   42(*):  76543210   43(+):  76543210
0    #             0   #              0    #             0        
1    #             1   #              1    #             1        
2    #             2   #              2    #             2        
3    #             3   #              3########          3        
4    #             4   #              4                  4########
5    #             5   #              5                  5    #   
6    #             6   #              6                  6    #   
7    #             7   #              7                  7    #   
44(,):  76543210   45(-):  76543210   46(.):  76543210   47(/):  76543210
0    #             0   #              0   #              0        
1    #             1   #              1   #              1        
2    #             2   #              2   #              2        
3    #             3   #              3   #              3   #####
4    ####          4####              4   #####          4   #    
5    #             5   #              5                  5   #    
6    #             6   #              6                  6   #    
7    #             7   #              7                  7   #    
48(0):  76543210   49(1):  76543210   50(2):  76543210   51(3):  76543210
0                  0    #             0   #              0#       
1                  1    #             1   #              1 #      
2                  2    #             2   #              2  #     
3#####             3    #             3   #              3   #####
4    #             4#####             4   #####          4   #    
5    #             5                  5  #               5   #    
6    #             6                  6 #                6   #    
7    #             7                  7#                 7   #    
52(4):  76543210   53(5):  76543210   54(6):  76543210   55(7):  76543210
0       #          0    #             0########          0########
1      #           1    #             1########          1########
2     #            2    #             2########          2########
3#####             3    #             3########          3########
4    #             4#####             4########          4########
5    #             5     #            5########          5        
6    #             6      #           6########          6        
7    #             7       #          7########          7        
56(8):  76543210   57(9):  76543210   58(:):  76543210   59(;):  76543210
0                  0#####             0   #####          0    #   
1                  1#####             1   #####          1    #   
2                  2#####             2   #####          2    #   
3########          3#####             3   #####          3########
4########          4#####             4   #####          4########
5########          5#####             5   #####          5########
6########          6#####             6   #####          6########
7########          7#####             7   #####          7########
60(<):  76543210   61(=):  76543210   62(>):  76543210   63(?):  76543210
0########          0#####             0   #####          0   #####
1########          1#####             1   #####          1   #####
2########          2#####             2   #####          2   #####
3########          3#####             3   #####          3   #####
4########          4########          4########          4   #####
5    #             5#####             5   #####          5        
6    #             6#####             6   #####          6        
7    #             7#####             7   #####          7        
64(@):  76543210   65(A):  76543210   66(B):  76543210   67(C):  76543210
0                  0                  0#####             0   #####
1                  1                  1#####             1   #####
2                  2                  2#####             2   #####
3   #####          3#####             3#####             3   #####
4   #####          4#####             4#####             4   #####
5   #####          5#####             5                  5  #     
6   #####          6#####             6                  6 #      
7   #####          7#####             7                  7#       
68(D):  76543210   69(E):  76543210   70(F):  76543210   71(G):  76543210
0#                 0       #          0#####             0       #
1 #                1      #           1#####             1        
2  #               2     #            2#####             2        
3   #####          3#####             3#####             3        
4   #####          4#####             4#####             4        
5   #####          5#####             5     #            5        
6   #####          6#####             6      #           6        
7   #####          7#####             7       #          7        
72(H):  76543210   73(I):  76543210   74(J):  76543210   75(K):  76543210
0                  0                  0#                 0########
1                  1                  1                  1        
2                  2                  2                  2        
3                  3                  3                  3        
4                  4                  4                  4        
5                  5                  5                  5        
6                  6                  6                  6        
7       #          7#                 7                  7        
76(L):  76543210   77(M):  76543210   78(N):  76543210   79(O):  76543210
0                  0#                 0       #          0        
1                  1#                 1       #          1########
2                  2#                 2       #          2        
3                  3#                 3       #          3        
4                  4#                 4       #          4        
5                  5#                 5       #          5        
6                  6#                 6       #          6########
7########          7#                 7       #          7        
80(P):  76543210   81(Q):  76543210   82(R):  76543210   83(S):  76543210
0                  0                  0                  0        
1########          1########          1########          1########
2#                 2##                2###               2####    
3#                 3##                3###               3####    
4#                 4##                4###               4####    
5#                 5##                5###               5####    
6########          6########          6########          6########
7                  7                  7                  7        
84(T):  76543210   85(U):  76543210   86(V):  76543210   87(W):  76543210
0                  0                  0                  0        
1########          1########          1########          1########
2#####             2######            2#######           2########
3#####             3######            3#######           3########
4#####             4######            4#######           4########
5#####             5######            5#######           5########
6########          6########          6########          6########
7                  7                  7                  7        
88(X):  76543210   89(Y):  76543210   90(Z):  76543210   91([):  76543210
0                  0                  0#      #          0    #   
1       #          1#                 1 #    #           1    #   
2       #          2#                 2  #  #            2    #   
3       #          3#                 3   ##             3    #   
4       #          4#                 4   ##             4########
5       #          5#                 5  #  #            5    #   
6       #          6#                 6 #    #           6    #   
7                  7                  7#      #          7    #   
92(\):  76543210   93(]):  76543210   94(^):  76543210   95(_):  76543210
0   ##             0   ##             0   ##             0########
1  ####            1   ##             1  ####            1#      #
2## ## ##          2   ##             2## ## ##          2#      #
3   ##             3   ##             3   ##             3#      #
4   ##             4## ## ##          4## ## ##          4#      #
5   ##             5  ####            5  ####            5#      #
6   ##             6   ##             6   ##             6#      #
7                  7                  7                  7########
96('):  76543210   97(a):  76543210   98(b):  76543210   99(c):  76543210
0  ####            0##   #            0 ##               0   #    
1 ##  ##           1# # #             1 # #              1   ##   
2     ##           2#  #              2 #  #             2   # #  
3    ##            3##                3 ###              3#  #  # 
4   ##             4# #               4 #  #             4 # #    
5                  5#  #              5 # #              5  ##    
6   ##             6#                 6 ##               6   #    
7                  7                  7                  7        
100(d):  76543210  101(e):  76543210  102(f):  76543210  103(g):  76543210
0#     #           0#     #           0#  # #            0#     # 
1##   ##           1##   ##           1# # #             1 #   #  
2# # # #           2# # # #           2## #              2  # #   
3#  #  #           3#  #  #           3# #               3   #    
4# # # #           4#     #           4##                4  # #   
5##   ##           5#     #           5#                 5 #   #  
6#     #           6#     #           6#                 6#     # 
7                  7                  7                  7        
104(h):  76543210  105(i):  76543210  106(j):  76543210  107(k):  76543210
0##    #           0   #              0   #              0   #    
1# #   #           1   #              1  ###             1   #    
2## #  #           2   #              2 # # #            2   #    
3# # # #           3   #              3#  #  #           3  ###   
4#  # ##           4   #              4 # # #            4 # # #  
5#   # #           5   #              5  ###             5#  #  # 
6#    ##           6   #              6   #              6#  #  # 
7                  7                  7                  7        
108(l):  76543210  109(m):  76543210  110(n):  76543210  111(o):  76543210
0   #              0##   ##           0#  #              0##   #  
1   ##             1# # # #           1 # #              1# # ##  
2   # #            2#  #  #           2  ###             2## # #  
3   #  #           3# # # #           3   # #            3# # #   
4   #              4##   ##           4   #  #           4#  #    
5   #              5#     #           5   #              5#       
6   #              6#     #           6   #              6#       
7                  7                  7                  7        
112(p):  76543210  113(q):  76543210  114(r):  76543210  115(s):  76543210
0#                 0 #                0 ##               0 #      
1#                 1 #                1 # #              1 #   #  
2#                 2 #                2 #  #             2 #  ##  
3#  #              3 ####             3 # #              3 # # #  
4# # #             4 #   #            4 ##               4 ##  #  
5##   #            5 #   #            5 # #              5 #   #  
6#     #           6 #   #            6 #  #             6     #  
7                  7                  7                  7        
116(t):  76543210  117(u):  76543210  118(v):  76543210  119(w):  76543210
0   #              0 ##               0   #              0 ##     
1  ###             1 # #              1# ### #           1 # #    
2 # # #            2 #  #             2 # # #            2 #  #   
3#  #  #           3 #   #            3   #              3 # #    
4   #              4 #   #            4   #              4 ##     
5   #              5 #   #            5   #              5 #      
6   #              6 #   #            6   #              6 #      
7                  7                  7                  7        
120(x):  76543210  121(y):  76543210  122(z):  76543210  123({):  76543210
0#  #  #           0###               0   #              0###  ###
1 # # #            1## #              1  # #             1##    ##
2  ###             2# # #             2 #   #            2  #  #  
3   #              3#  # #            3  # #             3###  ###
4   #              4#  ## #           4   #              4###  ###
5   #              5#  # ##           5  # #             5###  ###
6   #              6#  #  #           6 #   #            6###  ###
7                  7                  7                  7########
124( ):  76543210  125(}):  76543210  126(~):  76543210
0###  ###          0###  ###          0##    ##
1###  ###          1##    ##          1#  ##  #
2###  ###          2  #  #            2#####  #
3###  ###          3###  ###          3####  ##
4  #  #            4  #  #            4###  ###
5##    ##          5##    ##          5########
6###  ###          6###  ###          6###  ###
7########          7########          7########
`;
const specLines = spec.split('\n');
function getBits(code) {
    if (code < 32 || code >= 127) {
        throw new Error(`code out of range ${code}`);
    }
    const num = code - 32;
    const col = num % 4;
    const row = (num - col) / 4;
    const y = (row * 9) + 2;
    const x = (col * 19) + 1;
    // x and y are the top left of the bitmap for this character
    const bits = [];
    for (let i = 0; i < 8; i += 1) {
        for (let j = 0; j < 8; j += 1) {
            const char = specLines[y + i][x + j];
            if (char === '#') {
                bits.push(1);
            }
            else if (char === ' ') {
                bits.push(0);
            }
            else {
                throw new Error(`Unexpected char[${y + i}][${x + j}] ${char}`);
            }
        }
    }
    return bits;
}
function bitsToGif(bits, red, green, blue) {
    // make an 8x8 transparent GIF with pixels in a given color
    const nibs = [
        8, bits[0], bits[1], bits[2], bits[3], 8, bits[4], bits[5], bits[6], bits[7],
        8, bits[8], bits[9], bits[10], bits[11], 8, bits[12], bits[13], bits[14], bits[15],
        8, bits[16], bits[17], bits[18], bits[19], 8, bits[20], bits[21], bits[22], bits[23],
        8, bits[24], bits[25], bits[26], bits[27], 8, bits[28], bits[29], bits[30], bits[31],
        8, bits[32], bits[33], bits[34], bits[35], 8, bits[36], bits[37], bits[38], bits[39],
        8, bits[40], bits[41], bits[42], bits[43], 8, bits[44], bits[45], bits[46], bits[47],
        8, bits[48], bits[49], bits[50], bits[51], 8, bits[52], bits[53], bits[54], bits[55],
        8, bits[56], bits[57], bits[58], bits[59], 8, bits[60], bits[61], bits[62], bits[63],
    ];
    const bytes = [];
    for (let i = 0; i < nibs.length; i += 2) {
        bytes.push(nibs[i] + (16 * nibs[i + 1]));
    }
    const gif = [
        71, 73, 70, 56, 57, 97,
        8, 0,
        8, 0,
        128 + 64 + 32 + 16,
        0,
        0,
        0, 0, 0,
        red, green, blue,
        0x21,
        0xF9,
        4,
        1,
        0, 0,
        0,
        0,
        44,
        0, 0, 0, 0,
        8, 0, 8, 0,
        0,
        3,
        41,
        ...bytes,
        0x98,
        0,
        59
    ]; // semicolon
    return gif;
}
function base64Encode(bytes) {
    const codes = [];
    let i = 0;
    while (i < bytes.length) {
        // each loop consumes three bytes and produces 4 codes
        const byte1 = bytes[i];
        i += 1;
        const rem1 = byte1 % 4;
        const code1 = (byte1 - rem1) / 4;
        codes.push(code1);
        if (i < bytes.length) {
            const byte2 = bytes[i];
            i += 1;
            const rem2 = byte2 % 16;
            const code2 = (rem1 * 16) + ((byte2 - rem2) / 16);
            codes.push(code2);
            if (i < bytes.length) {
                const byte3 = bytes[i];
                i += 1;
                const code4 = byte3 % 64;
                const code3 = (rem2 * 4) + ((byte3 - code4) / 64);
                codes.push(code3);
                codes.push(code4);
            }
            else {
                const code3 = rem2 * 4;
                const code4 = 64;
                codes.push(code3);
                codes.push(code4);
            }
        }
        else {
            const code2 = (rem1 * 16);
            const code3 = 64;
            const code4 = 64;
            codes.push(code2);
            codes.push(code3);
            codes.push(code4);
        }
    }
    const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=';
    return codes.map((x) => chars.charAt(x)).join('');
}
const iconURICache = {};
export default class Icon {
    static getIconURI(code, color) {
        const key = `${code}${color}`;
        if (iconURICache[key] === undefined) {
            const red = Number.parseInt(color.slice(1, 3), 16);
            const green = Number.parseInt(color.slice(3, 5), 16);
            const blue = Number.parseInt(color.slice(5, 7), 16);
            const bits = getBits(code);
            const gifBytes = bitsToGif(bits, red, green, blue);
            const base64Gif = base64Encode(gifBytes);
            const uri = `data:image/gif;base64,${base64Gif}`;
            iconURICache[key] = uri;
        }
        return iconURICache[key];
    }
}
