import ScreenState from '../state/screen';
import Header from './header';
import Variable from './variable';
import Objects from './object';
import Strings from './string';
import ZSCII from './zscii';
import { BIT_15, BIT_16 } from '../utils/constants';
const SCORE_GAME = 1;
const TIME_GAME = 2;
export default class Status {
    static showStatus() {
        const version = Header.version();
        if (version > 3) {
            throw new Error(`Unexpected call to showStatus ${version}`);
        }
        let gameType = SCORE_GAME;
        if (version === 3 && Header.getFlags1(1)) {
            gameType = TIME_GAME;
        }
        const object = Variable.readVar(16);
        const nameWords = Objects.getNameWords(object);
        const zscii = Strings.zsciiFromWords(nameWords);
        const name = ZSCII.outputZSCIIToString(zscii);
        let progress;
        if (gameType === SCORE_GAME) {
            let score = Variable.readVar(17);
            if (score >= BIT_15) {
                score -= BIT_16;
            }
            const turns = Variable.readVar(18);
            progress = `${score}/${turns}`;
        }
        else {
            let hour = Variable.readVar(17);
            let daypart = 'AM';
            if (hour >= 12) {
                hour -= 12;
                daypart = 'PM';
            }
            if (hour === 0) {
                hour = 12;
            }
            const minutes = Variable.readVar(18).toString().padStart(2, '0');
            progress = `${hour}:${minutes} ${daypart}`;
        }
        const screen = ScreenState.getScreen();
        screen.status.display = true;
        screen.status.name = name;
        screen.status.progress = progress;
        screen.status.serial += 1;
        screen.serial += 1;
        ScreenState.flush();
    }
}
